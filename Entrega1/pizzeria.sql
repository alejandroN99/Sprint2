-- MySQL Script generated by MySQL Workbench
-- Tue Apr 25 10:49:13 2023
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema pizzeria
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema pizzeria
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `pizzeria` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `pizzeria` ;

-- -----------------------------------------------------
-- Table `pizzeria`.`category`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`category` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `pizzeria`.`store`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`store` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `adress` VARCHAR(100) NOT NULL,
  `cp` INT NOT NULL,
  `location` VARCHAR(45) NOT NULL,
  `province` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `pizzeria`.`employee`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`employee` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `surname` VARCHAR(45) NOT NULL,
  `NIF` INT NOT NULL,
  `phone` INT NOT NULL,
  `employee_id` INT NOT NULL,
  `type_employee` ENUM('chef', 'delivery_men', 'waiter') NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `employee_id_idx` (`employee_id` ASC) VISIBLE,
  CONSTRAINT `employee_id`
    FOREIGN KEY (`employee_id`)
    REFERENCES `pizzeria`.`store` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;

-- -----------------------------------------------------
-- Table `pizzeria`.`customer`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`customer` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `surrname` VARCHAR(45) NOT NULL,
  `adress` VARCHAR(100) NOT NULL,
  `pc` INT NOT NULL,
  `location` VARCHAR(45) NOT NULL,
  `province` VARCHAR(45) NOT NULL,
  `phone` INT NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `pizzeria`.`product`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`product` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `type_product` ENUM('Drink','Pizza','Hamburger') NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  `description` VARCHAR(80) NOT NULL,
  `imatge` BLOB NULL DEFAULT NULL,
  `price` VARCHAR(45) NOT NULL,
  `pizza_id` INT NULL,
  PRIMARY KEY (`id`),
  INDEX `pizza_id_idx` (`pizza_id` ASC) VISIBLE,
  CONSTRAINT `pizza_id`
    FOREIGN KEY (`pizza_id`)
    REFERENCES `pizzeria`.`category` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `pizzeria`.`commands_detail`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`commands_detail` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `products_id` INT NOT NULL,
  `amount` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `products_id` (`products_id` ASC) VISIBLE,
  CONSTRAINT `products_id`
    FOREIGN KEY (`products_id`)
    REFERENCES `pizzeria`.`product` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `pizzeria`.`commands`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`commands` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `date_time` DATETIME NOT NULL,
  `pick_order` ENUM('home', 'store') NOT NULL,
  `total_product` INT NOT NULL,
  `price` FLOAT NOT NULL,
  `customer_id` INT NOT NULL,
  `store_id` INT NOT NULL,
  `command_delivery` INT NULL,
  PRIMARY KEY (`id`),
  INDEX `customer_id_idx` (`customer_id` ASC) VISIBLE,
  INDEX `store_id_idx` (`store_id` ASC) VISIBLE,
  INDEX `total_product_idx` (`total_product` ASC) VISIBLE,
  INDEX `command_delivery_idx` (`command_delivery` ASC) VISIBLE,
  CONSTRAINT `command_delivery`
    FOREIGN KEY (`command_delivery`)
    REFERENCES `pizzeria`.`employee` (`id`),
  CONSTRAINT `customer_id`
    FOREIGN KEY (`customer_id`)
    REFERENCES `pizzeria`.`customer` (`id`),
  CONSTRAINT `store_id`
    FOREIGN KEY (`store_id`)
    REFERENCES `pizzeria`.`store` (`id`),
  CONSTRAINT `total_product`
    FOREIGN KEY (`total_product`)
    REFERENCES `pizzeria`.`commands_detail` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

INSERT INTO category (name)
VALUES ('Carne'),
('Vegana'),
('Solo_queso');

SELECT * FROM category;

INSERT INTO product (name,type_product,description,imatge,price,pizza_id)
VALUES ('Pizza_Margarita','Pizza', 'Muy buena', NULL , 10.50, 3),
 ('Hamburger_vegan', 'Hamburger','Sin animal', NULL , 12.50, NULL),
 ('Hamburger_carne', 'Hamburger','De cerdo', NULL , 13.50, NULL),
 ('Pizza_BBQ','Pizza', 'Salsa BBQ', NULL , 15.50,1),
 ('Fanta','Drink', 'Naranja', NULL , 3.5, NULL),
 ('Agua','Drink', 'Muy transparente, sin cal ', NULL , 2.50, NULL);
 
 SELECT * FROM product;
 
 INSERT INTO commands_detail (products_id, amount)
 VALUES (1 , 2),
 (2, 3),
 (3 , 4),
 (4 , 5),
 (5 , 6),
 (6, 7);
 SELECT * FROM commands_detail;
 
 INSERT INTO store (id, adress, cp, location, province)
 VALUES (1, 'Calle Marina 250', 08005, 'Barcelona', 'Barcelona'),
 (2, 'Calle Lepanto 20', 08007, 'Barcelona', 'Barcelona');
 SELECT * FROM store;
 
 INSERT INTO employee (id, name, surname, NIF, phone, employee_id, type_employee)
 VALUES (1, 'Alejandro','Rodriguez', 11111111, 655538888, 1, 'chef'),
 (2, 'Sara','Lopez', 11111112, 655538777, 1, 'delivery_men'),
 (3, 'Maria','Baeza', 11111113, 655538666, 2, 'chef'),
 (4, 'Jordi','Perez', 11111114, 655538555, 2, 'delivery_men');

SELECT * FROM employee;

INSERT INTO customer (id, name, surrname, adress, pc, location, province, phone)
VALUES (1, 'Pepe', 'Garcia', 'Calle Llull 18','08004','Barcelona', 'Barcelona',623456789),
(2, 'Juan', 'Saez', 'Calle Marina 180','08005','Barcelona', 'Barcelona',623456788),
(3, 'Jose', 'Perez', 'Calle Aragon 170','08006','Barcelona', 'Barcelona',623456787),
(4, 'Rafa', 'Garcia', 'Calle Mallorca 44','08007','Barcelona', 'Barcelona',623456786),
(5, 'Marta', 'Lopez', 'Calle Pujades 55','08008','Barcelona', 'Barcelona',623456785),
(6, 'Julia', 'Castillo', 'Calle Bolivia 100','08009','Barcelona', 'Barcelona',623456784);

select * from customer;
INSERT INTO commands (id, date_time, pick_order,total_product,price,customer_id,store_id,command_delivery)
VALUES (1, '2023-01-01 21:00', 'home', 7, 21, 1, 1, 2 ),
 (2, '2023-01-02 20:00', 'home', 8, 40, 2, 2, 4 ),
  (3, '2023-01-03 19:00', 'store', 9, 70, 3, 1, 1 ),
   (4, '2023-01-04 18:00', 'store', 10, 65, 4, 2, 3 ),
    (5, '2023-01-05 17:00', 'store', 11, 5, 5, 1, 1),
     (6, '2023-01-06 22:00', 'home', 12, 8, 6, 2, 2 );
SELECT * FROM commands;

-- Llista quants productes de tipus “Begudes”. s'han venut en una determinada localitat.

SELECT p.name, p.type_product, cd.amount, c.customer_id, customer.location FROM product p 
JOIN  commands_detail cd ON p.id = products_id 
JOIN commands c ON cd.id = c.total_product
JOIN customer ON c.customer_id = customer.id
where p.type_product = 'Drink' AND customer.location = 'Barcelona';


-- Llista quantes comandes ha efectuat un determinat empleat/da.

SELECT e.id AS eployee, e.name ,e.surname, count(c.command_delivery = 2) AS num_commands FROM employee e 
RIGHT JOIN commands c 
ON e.id = c.command_delivery 
where e.id = 2;



